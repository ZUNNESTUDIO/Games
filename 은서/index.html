<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ÎØ∏ÏïºÏò¨ Ï†êÌîÑ Ïñ¥ÎìúÎ≤§Ï≤ò</title>
  <style>
    :root {
      --sky: linear-gradient(120deg, #ff9de6, #9bf6ff, #ffd166, #caffbf, #bdb2ff);
      --ground: #fff9f3;
      --text: #2c2c54;
      --shadow: rgba(0, 0, 0, 0.15);
      --bar: linear-gradient(90deg, #ff8fb1, #ffd166, #8ef6e4, #a29bfe);
      --boss: linear-gradient(120deg, #ff6fb7, #ff9f1c, #8ecae6);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Noto Sans KR', 'Pretendard', system-ui, sans-serif;
      color: var(--text);
      background: #0f172a;
      overflow-x: hidden;
    }

    .rainbow-bg {
      position: fixed;
      inset: 0;
      background: linear-gradient(120deg, #ff9de6, #9bf6ff, #ffd166, #caffbf, #bdb2ff, #ffadad);
      background-size: 400% 400%;
      animation: rainbowFlow 18s ease infinite;
      z-index: -2;
    }

    .sparkles {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image: radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.4), transparent 40%),
        radial-gradient(circle at 80% 10%, rgba(255, 255, 255, 0.3), transparent 45%),
        radial-gradient(circle at 50% 70%, rgba(255, 255, 255, 0.25), transparent 50%);
      filter: blur(0.4px);
      animation: twinkle 6s ease-in-out infinite;
      z-index: -1;
    }

    @keyframes rainbowFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    header {
      text-align: center;
      padding: 20px;
      color: #fff;
      text-shadow: 0 4px 14px rgba(0, 0, 0, 0.25);
    }

    h1 {
      margin: 0 0 8px;
      font-size: 36px;
    }

    .start-screen, .result-screen, .costume-modal {
      background: rgba(255, 255, 255, 0.9);
      width: min(900px, 94%);
      margin: 10px auto;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 20px 60px var(--shadow);
      text-align: center;
    }

    .start-screen h2 { margin-top: 0; }

    .difficulty-btn {
      border: none;
      padding: 14px 30px;
      margin: 10px;
      font-size: 18px;
      font-weight: 700;
      border-radius: 14px;
      cursor: pointer;
      box-shadow: 0 10px 25px var(--shadow);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .difficulty-btn:hover { transform: translateY(-3px) scale(1.02); }

    .easy { background: linear-gradient(135deg, #b7f7c0, #7bf1a8); }
    .normal { background: linear-gradient(135deg, #ffe58f, #ffc46b); }
    .hard { background: linear-gradient(135deg, #ffadad, #ff7b7b); }

    .game-wrapper {
      width: min(960px, 94%);
      margin: 0 auto 40px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 20px 60px var(--shadow);
      display: none;
      position: relative;
    }

    .hud {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .hud .pill {
      background: rgba(255, 255, 255, 0.9);
      padding: 10px 14px;
      border-radius: 12px;
      box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.05);
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .progress {
      flex: 1;
      height: 16px;
      background: #f1f1f1;
      border-radius: 999px;
      overflow: hidden;
      box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.08);
      position: relative;
    }

    .progress span {
      display: block;
      height: 100%;
      width: 0;
      background: var(--bar);
      background-size: 200% 200%;
      animation: rainbowFlow 10s linear infinite;
    }

    #gameArea {
      position: relative;
      width: 900px;
      max-width: 100%;
      height: 440px;
      margin: 0 auto;
      background: linear-gradient(to top, #fff9f3 20%, rgba(255,255,255,0));
      overflow: hidden;
      border-radius: 16px;
      border: 4px solid rgba(255, 255, 255, 0.7);
      box-shadow: inset 0 -10px 40px rgba(0, 0, 0, 0.08);
    }

    .ground-line {
      position: absolute;
      bottom: 60px;
      left: 0;
      width: 100%;
      height: 6px;
      background: linear-gradient(90deg, #ffb5e8, #b5e8ff, #ffdfba, #c7ffd8, #b5b9ff);
      filter: blur(0.5px);
    }

    .platform { position: absolute; bottom: 0; left: 0; width: 100%; height: 60px; background: transparent; }

    .cat {
      position: absolute;
      width: 80px;
      height: 90px;
      bottom: 60px;
      left: 80px;
      transform-origin: center;
      transition: filter 0.2s ease;
    }

    .cat::before,
    .cat::after {
      content: '';
      position: absolute;
      display: block;
    }

    /* Cat 1: simple round */
    .cat.cat-1 {
      background: radial-gradient(circle at 30% 30%, #fff3f3, #ffc7e6);
      border-radius: 50% 50% 55% 55%;
      box-shadow: inset -6px -10px 0 rgba(0, 0, 0, 0.05);
    }

    .cat.cat-1::before { /* ears */
      width: 18px;
      height: 18px;
      background: #ffc7e6;
      border-radius: 4px 14px 4px 14px;
      box-shadow: 44px -2px 0 #ffc7e6;
      top: -6px;
      left: 6px;
      transform: rotate(-12deg);
    }

    .cat.cat-1::after { /* whiskers */
      width: 60px;
      height: 4px;
      background: linear-gradient(90deg, rgba(0,0,0,0.25), rgba(0,0,0,0.05));
      top: 46px;
      left: 10px;
      box-shadow: 0 8px 0 rgba(0, 0, 0, 0.15);
      border-radius: 4px;
    }

    .cat .face {
      position: absolute;
      width: 36px;
      height: 20px;
      background: #fff;
      border-radius: 50%;
      left: 22px;
      top: 30px;
      box-shadow: inset 0 -2px 0 rgba(0, 0, 0, 0.08);
    }

    .cat .eye {
      position: absolute;
      width: 8px;
      height: 12px;
      background: #2c2c54;
      border-radius: 50%;
      top: 3px;
      animation: blink 6s infinite;
    }

    .cat .eye.left { left: 8px; }
    .cat .eye.right { right: 8px; }

    .cat .nose {
      position: absolute;
      width: 8px;
      height: 6px;
      background: #ff6f91;
      border-radius: 50%;
      left: 14px;
      top: 12px;
      box-shadow: 0 6px 0 #ffb6c1;
    }

    .cat .cheek {
      position: absolute;
      width: 10px;
      height: 6px;
      background: #ffb3c6;
      border-radius: 50%;
      top: 13px;
    }

    .cat .cheek.left { left: -2px; }
    .cat .cheek.right { right: -2px; }

    /* Cat 2: striped */
    .cat.cat-2 {
      background: linear-gradient(140deg, #fff6d6, #ffd166);
      border-radius: 54% 46% 55% 52%;
      box-shadow: inset -5px -8px 0 rgba(0, 0, 0, 0.08);
    }

    .cat.cat-2::before {
      content: '';
      position: absolute;
      width: 80px;
      height: 90px;
      left: 0;
      top: 0;
      background: repeating-linear-gradient(-45deg, rgba(255, 149, 128, 0.7) 0 10px, transparent 10px 20px);
      border-radius: inherit;
      mix-blend-mode: multiply;
      opacity: 0.7;
    }

    .cat.cat-2::after {
      content: '';
      position: absolute;
      width: 14px;
      height: 16px;
      background: #ffd166;
      border-radius: 50%;
      top: -4px;
      left: 10px;
      box-shadow: 52px -2px 0 #ffd166;
    }

    /* Cat 3: fancy accessories */
    .cat.cat-3 {
      background: linear-gradient(160deg, #c4d9ff, #a29bfe);
      border-radius: 50% 52% 55% 50%;
      box-shadow: inset -4px -8px 0 rgba(0, 0, 0, 0.08), 0 0 0 4px rgba(255, 255, 255, 0.4);
    }

    .cat.cat-3::before {
      width: 16px;
      height: 16px;
      background: #a29bfe;
      border-radius: 4px 12px 4px 12px;
      top: -6px;
      left: 12px;
      box-shadow: 42px -2px 0 #a29bfe;
    }

    .cat.cat-3::after {
      width: 18px;
      height: 12px;
      background: linear-gradient(120deg, #ff9de6, #ffd166);
      border-radius: 10px;
      bottom: 12px;
      left: 30px;
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.6);
    }

    .cat.cat-3 .accessory {
      position: absolute;
      width: 50px;
      height: 16px;
      background: linear-gradient(90deg, #ffb6c1, #ff9de6);
      border-radius: 10px;
      top: -10px;
      left: 14px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .cat.cat-3 .accessory::before,
    .cat.cat-3 .accessory::after {
      content: '';
      position: absolute;
      width: 14px;
      height: 14px;
      background: linear-gradient(120deg, #ffe68f, #ffb6c1);
      border-radius: 50%;
      top: -6px;
    }

    .cat.cat-3 .accessory::before { left: -6px; }
    .cat.cat-3 .accessory::after { right: -6px; }

    @keyframes blink {
      0%, 90%, 100% { height: 12px; }
      92%, 96% { height: 2px; }
    }

    .obstacle {
      position: absolute;
      width: 46px;
      height: 46px;
      border-radius: 12px;
      bottom: 60px;
      background: linear-gradient(145deg, #ff9de6, #9bf6ff);
      box-shadow: 0 8px 16px var(--shadow), inset 0 -4px 8px rgba(0,0,0,0.12);
      animation: bob 1.5s ease-in-out infinite;
    }

    .monster {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      bottom: 60px;
      box-shadow: inset -6px -8px 0 rgba(0,0,0,0.1);
      animation: bounce 1.8s ease-in-out infinite;
    }

    .monster::before, .monster::after {
      content: '';
      position: absolute;
      background: #2c2c54;
      border-radius: 50%;
    }

    .monster::before {
      width: 10px;
      height: 14px;
      top: 18px;
      left: 14px;
      box-shadow: 22px 0 0 #2c2c54;
    }

    .monster::after {
      width: 20px;
      height: 10px;
      bottom: 14px;
      left: 20px;
      border-radius: 50% 50% 40% 40%;
      background: #ffb3c6;
    }

    .pink { background: linear-gradient(150deg, #ffc8dd, #ffafcc); }
    .purple { background: linear-gradient(150deg, #b5b9ff, #9381ff); }
    .yellow { background: linear-gradient(150deg, #ffe58f, #ffc46b); }
    .green { background: linear-gradient(150deg, #b5f7c0, #7bf1a8); }

    .boss {
      position: absolute;
      width: 160px;
      height: 140px;
      border-radius: 50% 50% 48% 48%;
      background: var(--boss);
      bottom: 60px;
      left: 720px;
      box-shadow: 0 16px 28px var(--shadow), inset -10px -14px 0 rgba(0,0,0,0.1);
      animation: bossPulse 2.5s ease-in-out infinite;
      overflow: hidden;
    }

    .boss::before {
      content: '';
      position: absolute;
      inset: 8px;
      border-radius: 40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), transparent 60%);
      mix-blend-mode: screen;
    }

    .boss::after {
      content: '';
      position: absolute;
      width: 60px;
      height: 16px;
      background: rgba(255,255,255,0.6);
      border-radius: 999px;
      top: 18px;
      left: 20px;
      box-shadow: 60px 4px 0 rgba(255,255,255,0.6);
    }

    .boss .mouth {
      position: absolute;
      width: 80px;
      height: 36px;
      background: #fff;
      border-radius: 0 0 40px 40px;
      bottom: 24px;
      left: 40px;
      box-shadow: inset 0 -8px 0 #ffb3c6;
    }

    .boss .eye-line {
      position: absolute;
      width: 10px;
      height: 26px;
      background: #2c2c54;
      border-radius: 10px;
      top: 50px;
      left: 48px;
      box-shadow: 54px 0 0 #2c2c54;
    }

    .boss .crown {
      position: absolute;
      width: 60px;
      height: 30px;
      background: linear-gradient(120deg, #ffe58f, #ffb6c1);
      top: -6px;
      left: 50px;
      clip-path: polygon(0 100%, 20% 0, 40% 100%, 60% 0, 80% 100%, 100% 0, 100% 100%);
      box-shadow: 0 10px 16px rgba(0,0,0,0.12);
    }

    @keyframes bob { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
    @keyframes bossPulse { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-6px) scale(1.03); } }

    .coin {
      position: absolute;
      border-radius: 50%;
      bottom: 120px;
      width: 26px;
      height: 26px;
      background: radial-gradient(circle at 30% 30%, #fff, #ffd166);
      box-shadow: 0 8px 16px var(--shadow);
      animation: spin 1s linear infinite;
    }

    .coin.big {
      width: 36px;
      height: 36px;
      background: radial-gradient(circle at 30% 30%, #fff, #ffdf6b);
      box-shadow: 0 10px 18px var(--shadow), 0 0 0 4px rgba(255, 255, 255, 0.6);
    }

    .coin.big::after {
      content: '';
      position: absolute;
      inset: 6px;
      border-radius: 50%;
      border: 2px dashed rgba(255, 255, 255, 0.8);
    }

    .trail {
      position: absolute;
      width: 60px;
      height: 6px;
      background: linear-gradient(90deg, rgba(255,157,230,0.8), rgba(155,246,255,0.6));
      border-radius: 999px;
      filter: blur(1px);
      opacity: 0.8;
      animation: trailFade 0.4s ease forwards;
      pointer-events: none;
    }

    @keyframes trailFade { to { opacity: 0; transform: translateX(-20px) scaleX(0.8); } }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    .popup {
      position: absolute;
      color: #ff6f91;
      font-weight: 800;
      text-shadow: 0 2px 6px rgba(0,0,0,0.2);
      animation: popup 0.9s ease forwards;
      pointer-events: none;
    }

    @keyframes popup {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-30px); }
    }

    .particle {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: linear-gradient(120deg, #ff9de6, #9bf6ff);
      opacity: 0.9;
      animation: particle 0.8s ease-out forwards;
      pointer-events: none;
    }

    @keyframes particle { to { transform: translateY(-40px) scale(0.4); opacity: 0; } }

    .shake { animation: shake 0.4s ease; }
    @keyframes shake {
      0%,100% { transform: translate(0); }
      20% { transform: translate(-8px, 4px); }
      40% { transform: translate(8px, -4px); }
      60% { transform: translate(-4px, 4px); }
      80% { transform: translate(4px, -4px); }
    }

    .celebrate {
      animation: celebrate 1s ease;
      box-shadow: 0 0 0 6px rgba(255,255,255,0.6), 0 14px 40px rgba(0,0,0,0.2);
    }

    @keyframes celebrate {
      0% { transform: scale(1); }
      30% { transform: scale(1.04); }
      60% { transform: scale(0.98); }
      100% { transform: scale(1); }
    }

    .result-screen { display: none; }

    .restart {
      padding: 12px 26px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #9bf6ff, #b5f7c0);
      font-size: 18px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 10px 30px var(--shadow);
    }

    .costume-modal {
      display: none;
    }

    .costume-options {
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .costume-button {
      border: none;
      padding: 10px 16px;
      border-radius: 12px;
      cursor: pointer;
      background: #f4f4ff;
      box-shadow: 0 10px 22px var(--shadow);
      transition: transform 0.2s ease;
      font-weight: 700;
    }

    .costume-button:hover { transform: translateY(-4px); }

    .costume-preview {
      width: 60px;
      height: 60px;
      margin-bottom: 6px;
      border-radius: 50%;
      position: relative;
    }

    .outfit-star { background: linear-gradient(135deg, #ffe58f, #ffd166); box-shadow: 0 0 0 4px rgba(255, 214, 102, 0.5); }
    .outfit-heart { background: linear-gradient(135deg, #ffb6c1, #ff9de6); box-shadow: 0 0 0 4px rgba(255, 182, 193, 0.5); }
    .outfit-sky { background: linear-gradient(135deg, #9bf6ff, #b5e8ff); box-shadow: 0 0 0 4px rgba(155, 246, 255, 0.5); }
    .outfit-rainbow { background: conic-gradient(#ff9de6, #ffd166, #9bf6ff, #b5f7c0, #b5b9ff); box-shadow: 0 0 0 4px rgba(255,255,255,0.6); }

    .boss-bar {
      width: 100%;
      height: 12px;
      background: #ffe4ec;
      border-radius: 999px;
      overflow: hidden;
      box-shadow: inset 0 3px 8px rgba(0,0,0,0.1);
      margin-top: 8px;
      display: none;
    }

    .boss-bar span {
      display: block;
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #ff6f91, #ffdf6b);
    }

    .floating-ui {
      position: absolute;
      top: 12px;
      left: 12px;
      background: rgba(255,255,255,0.9);
      padding: 10px 14px;
      border-radius: 12px;
      box-shadow: 0 10px 24px var(--shadow);
      font-weight: 700;
    }

    /* Cute sound placeholders */
    /* const jumpSound = new Audio('jump.mp3'); */
  </style>
</head>
<body>
  <div class="rainbow-bg"></div>
  <div class="sparkles"></div>
  <header>
    <h1>üåà ÎØ∏ÏïºÏò¨ Ï†êÌîÑ Ïñ¥ÎìúÎ≤§Ï≤ò</h1>
    <p>ÏùÄÏÑúÏùò ÏÜêÍ∑∏Î¶ºÏùÑ ÎãÆÏùÄ Í∑ÄÏó¨Ïö¥ Í≥†ÏñëÏù¥ÏôÄ Î¨¥ÏßÄÍ∞ú ÏÑ∏Í≥ÑÎ•º Îã¨Î†§Ïöî!</p>
  </header>

  <div class="start-screen" id="startScreen">
    <h2>ÎÇúÏù¥ÎèÑÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h2>
    <p>‚Üê ‚Üí Î°ú Ïù¥Îèô, ‚Üë/Ïä§ÌéòÏù¥Ïä§Î°ú Ï†êÌîÑ! ÏΩîÏù∏ 5Ï†êÏùÑ Î™®ÏúºÎ©¥ Î†àÎ≤®ÏóÖÌï¥Ïöî.</p>
    <div>
      <button class="difficulty-btn easy" onclick="startGame('easy')">Ï¥àÎ≥¥</button>
      <button class="difficulty-btn normal" onclick="startGame('normal')">Ï§ëÏàò</button>
      <button class="difficulty-btn hard" onclick="startGame('hard')">Í≥†Ïàò</button>
    </div>
    <p style="margin-top:16px">ÏõêÌïòÎäî Í≥†ÏñëÏù¥Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî:</p>
    <div style="display:flex;gap:14px;justify-content:center;flex-wrap:wrap">
      <button class="difficulty-btn" style="background:#ffc7e6" onclick="selectCat(1)">Îë•Í∏ÄÎë•Í∏Ä ÎØ∏Ïïº</button>
      <button class="difficulty-btn" style="background:#ffd166" onclick="selectCat(2)">Ï§ÑÎ¨¥Îä¨ ÎØ∏Ïïº</button>
      <button class="difficulty-btn" style="background:#a29bfe;color:#fff" onclick="selectCat(3)">Î©ãÏüÅÏù¥ ÎØ∏Ïïº</button>
    </div>
    <p id="selectedCat" style="font-weight:800;color:#ff6f91;margin-top:10px">ÏÑ†ÌÉù: Îë•Í∏ÄÎë•Í∏Ä ÎØ∏Ïïº</p>
  </div>

  <div class="game-wrapper" id="gameWrapper">
    <div class="hud">
      <div class="pill">Î†àÎ≤® <span id="level">1</span></div>
      <div class="pill">Ï†êÏàò <span id="score">0</span></div>
      <div class="pill">ÏÜçÎèÑ <span id="speed">1.0x</span></div>
      <div class="pill">ÏΩîÏù∏ <span id="coinText">0/5</span></div>
      <div class="progress"><span id="progressBar"></span></div>
    </div>
    <div class="boss-bar" id="bossBar"><span></span></div>
    <div id="gameArea">
      <div class="ground-line"></div>
      <div class="platform"></div>
      <div class="cat cat-1" id="player">
        <div class="face">
          <div class="eye left"></div>
          <div class="eye right"></div>
          <div class="nose"></div>
          <div class="cheek left"></div>
          <div class="cheek right"></div>
        </div>
        <div class="accessory" style="display:none"></div>
      </div>
    </div>
    <div class="floating-ui" id="statusText">Ï§ÄÎπÑ!</div>
  </div>

  <div class="result-screen" id="resultScreen">
    <h2 id="resultMessage"></h2>
    <button class="restart" onclick="restartGame()">Îã§Ïãú Îã¨Î¶¨Í∏∞</button>
  </div>

  <div class="costume-modal" id="costumeModal">
    <h3>Î†àÎ≤®ÏóÖ! ÏÉàÎ°úÏö¥ ÏùòÏÉÅ ÏÑ†ÌÉù</h3>
    <div class="costume-options">
      <button class="costume-button" onclick="applyCostume('outfit-star')">
        <div class="costume-preview outfit-star"></div>
        Î≥ÑÎπõ Î¶¨Î≥∏
      </button>
      <button class="costume-button" onclick="applyCostume('outfit-heart')">
        <div class="costume-preview outfit-heart"></div>
        ÌïòÌä∏ Î®∏Î¶¨ÌïÄ
      </button>
      <button class="costume-button" onclick="applyCostume('outfit-sky')">
        <div class="costume-preview outfit-sky"></div>
        ÌååÏä§ÌÖî ÎßùÌÜ†
      </button>
      <button class="costume-button" onclick="applyCostume('outfit-rainbow')">
        <div class="costume-preview outfit-rainbow"></div>
        Î¨¥ÏßÄÍ∞ú ÏôïÍ¥Ä (Í≥†Î†àÎ≤®)
      </button>
    </div>
  </div>

  <div class="result-screen" id="bossDefeat" style="display:none">
    <h2>üåà Î¨¥ÏßÄÍ∞ú Ìè≠Ï£Ω! Î≥¥Ïä§ Í≤©Ìåå!</h2>
  </div>

  <script>
    const gameArea = document.getElementById('gameArea');
    const playerEl = document.getElementById('player');
    const startScreen = document.getElementById('startScreen');
    const gameWrapper = document.getElementById('gameWrapper');
    const resultScreen = document.getElementById('resultScreen');
    const resultMessage = document.getElementById('resultMessage');
    const statusText = document.getElementById('statusText');
    const levelText = document.getElementById('level');
    const scoreText = document.getElementById('score');
    const coinText = document.getElementById('coinText');
    const progressBar = document.getElementById('progressBar');
    const speedText = document.getElementById('speed');
    const bossBar = document.getElementById('bossBar');
    const bossGauge = bossBar.querySelector('span');
    const costumeModal = document.getElementById('costumeModal');
    const selectedCat = document.getElementById('selectedCat');

    const DIFFICULTY_SETTINGS = {
      easy: { baseSpeed: 3, jump: -11, gravity: 0.6 },
      normal: { baseSpeed: 4, jump: -12, gravity: 0.7 },
      hard: { baseSpeed: 5, jump: -13, gravity: 0.8 }
    };

    const keys = {};
    let currentCat = 1;
    let difficulty = DIFFICULTY_SETTINGS.easy;
    let player = {};
    let objects = [];
    let monsters = [];
    let boss = null;
    let bossHealth = 0;
    let bossMaxHealth = 0;
    let coinScore = 0;
    let level = 1;
    let score = 0;
    let gameOver = false;
    let lastSpawn = 0;
    let coinTimer = 0;
    let monsterTimer = 0;
    let bossTimer = 0;
    let speedMultiplier = 1;
    let lastTime = 0;

    document.addEventListener('keydown', (e) => {
      keys[e.key.toLowerCase()] = true;
    });
    document.addEventListener('keyup', (e) => {
      keys[e.key.toLowerCase()] = false;
    });

    function selectCat(num) {
      currentCat = num;
      playerEl.classList.remove('cat-1', 'cat-2', 'cat-3');
      playerEl.classList.add(`cat-${num}`);
      playerEl.querySelector('.accessory').style.display = num === 3 ? 'block' : 'none';
      const names = ['Îë•Í∏ÄÎë•Í∏Ä ÎØ∏Ïïº', 'Ï§ÑÎ¨¥Îä¨ ÎØ∏Ïïº', 'Î©ãÏüÅÏù¥ ÎØ∏Ïïº'];
      selectedCat.textContent = `ÏÑ†ÌÉù: ${names[num - 1]}`;
    }

    function startGame(levelKey) {
      difficulty = DIFFICULTY_SETTINGS[levelKey];
      resetGame();
      startScreen.style.display = 'none';
      gameWrapper.style.display = 'block';
      resultScreen.style.display = 'none';
      requestAnimationFrame(loop);
    }

    function resetGame() {
      objects.forEach(o => o.el.remove());
      monsters.forEach(m => m.el.remove());
      if (boss) boss.el.remove();
      objects = [];
      monsters = [];
      boss = null;
      coinScore = 0;
      level = 1;
      score = 0;
      speedMultiplier = 1;
      bossBar.style.display = 'none';
      bossHealth = 0;
      bossMaxHealth = 0;
      player = {
        x: 80,
        y: 280,
        w: 80,
        h: 90,
        vy: 0,
        onGround: true,
        costume: null
      };
      updateHUD();
      statusText.textContent = 'Ï∂úÎ∞ú!';
      gameOver = false;
      lastTime = performance.now();
    }

    function loop(timestamp) {
      if (gameOver) return;
      const delta = Math.min(32, timestamp - lastTime);
      lastTime = timestamp;
      update(delta);
      requestAnimationFrame(loop);
    }

    function update(delta) {
      handleInput();
      applyPhysics();
      spawnObjects(delta);
      moveObjects(delta);
      checkCollisions();
      updateHUD();
    }

    function handleInput() {
      const speed = 4 * speedMultiplier;
      if (keys['arrowleft'] || keys['a']) player.x = Math.max(0, player.x - speed);
      if (keys['arrowright'] || keys['d']) player.x = Math.min(gameArea.clientWidth - player.w, player.x + speed);
      if ((keys['arrowup'] || keys[' ']) && player.onGround) jump();
      playerEl.style.transform = `translate(${player.x}px, ${player.y}px)`;
    }

    function jump() {
      if (!player.onGround) return;
      player.vy = difficulty.jump;
      player.onGround = false;
      createParticles(player.x + player.w / 2, gameArea.clientHeight - 60);
      // jumpSound.play();
    }

    function applyPhysics() {
      player.vy += difficulty.gravity;
      player.y += player.vy;
      const floor = gameArea.clientHeight - 60 - player.h;
      if (player.y > floor) {
        player.y = floor;
        player.vy = 0;
        player.onGround = true;
      }
    }

    function spawnObjects(delta) {
      lastSpawn += delta;
      coinTimer += delta;
      monsterTimer += delta;
      bossTimer += delta;
      const spawnInterval = Math.max(550 - level * 20, 240);
      if (lastSpawn > spawnInterval && !boss) {
        lastSpawn = 0;
        const isRainbow = Math.random() < 0.4;
        const obstacle = document.createElement('div');
        obstacle.className = 'obstacle';
        obstacle.style.background = isRainbow ? `linear-gradient(135deg, ${randomColor()}, ${randomColor()})` : obstacle.style.background;
        gameArea.appendChild(obstacle);
        objects.push({ el: obstacle, type: 'obstacle', x: gameArea.clientWidth + 20, y: gameArea.clientHeight - 106, w: 46, h: 46, speed: getSpeed() });
      }

      if (coinTimer > 600) {
        coinTimer = 0;
        const coin = document.createElement('div');
        const big = Math.random() < 0.35;
        coin.className = big ? 'coin big' : 'coin';
        gameArea.appendChild(coin);
        objects.push({ el: coin, type: big ? 'coin2' : 'coin1', x: gameArea.clientWidth + 20, y: gameArea.clientHeight - (big ? 200 : 160), w: big ? 36 : 26, h: big ? 36 : 26, speed: getSpeed() * 0.9, points: big ? 2 : 1 });
      }

      if (monsterTimer > 1500 && !boss) {
        monsterTimer = 0;
        spawnMonster();
      }

      if (level % 5 === 0 && !boss) {
        spawnBoss();
      }
    }

    function spawnMonster() {
      const el = document.createElement('div');
      const colors = ['pink', 'purple', 'yellow', 'green'];
      el.className = `monster ${colors[Math.floor(Math.random() * colors.length)]}`;
      gameArea.appendChild(el);
      monsters.push({ el, x: gameArea.clientWidth + 10, y: gameArea.clientHeight - 120, w: 60, h: 60, speed: getSpeed() * 0.8, dir: 1 });
    }

    function spawnBoss() {
      boss = { el: document.createElement('div'), x: gameArea.clientWidth - 180, y: gameArea.clientHeight - 200, w: 160, h: 140, speed: 1.2 };
      boss.el.className = 'boss';
      boss.el.innerHTML = '<div class="crown"></div><div class="eye-line"></div><div class="mouth"></div>';
      gameArea.appendChild(boss.el);
      bossHealth = bossMaxHealth = 12;
      bossBar.style.display = 'block';
      statusText.textContent = 'Î≥¥Ïä§ Îì±Ïû•! Ï†êÌîÑÎ°ú Î®∏Î¶¨Î•º ÌÜ°!';
    }

    function moveObjects(delta) {
      const moveBy = (obj) => obj.speed * speedMultiplier;
      objects = objects.filter(obj => {
        obj.x -= moveBy(obj);
        obj.el.style.transform = `translate(${obj.x}px, ${obj.y}px)`;
        if (obj.x < -120) { obj.el.remove(); return false; }
        if (obj.type === 'coin1' || obj.type === 'coin2') createTrail(obj);
        return true;
      });

      monsters = monsters.filter(m => {
        m.x -= moveBy(m);
        m.y = gameArea.clientHeight - 120 + Math.sin(Date.now() / 280) * 10;
        m.el.style.transform = `translate(${m.x}px, ${m.y}px)`;
        if (m.x < -100) { m.el.remove(); return false; }
        return true;
      });

      if (boss) {
        boss.x -= boss.speed;
        if (boss.x < gameArea.clientWidth - 260 || boss.x > gameArea.clientWidth - 120) boss.speed *= -1;
        boss.el.style.transform = `translate(${boss.x}px, ${boss.y}px)`;
        if (bossTimer > 800) {
          bossTimer = 0;
          spawnRainbowAttack();
        }
      }
    }

    function spawnRainbowAttack() {
      const atk = document.createElement('div');
      atk.className = 'obstacle';
      atk.style.width = '32px';
      atk.style.height = '32px';
      atk.style.background = 'conic-gradient(#ff9de6, #ffd166, #9bf6ff, #b5f7c0)';
      gameArea.appendChild(atk);
      objects.push({ el: atk, type: 'obstacle', x: boss.x, y: boss.y + 80, w: 32, h: 32, speed: getSpeed() + 1.5 });
    }

    function createTrail(obj) {
      if (Math.random() > 0.4) return;
      const trail = document.createElement('div');
      trail.className = 'trail';
      trail.style.left = `${obj.x}px`;
      trail.style.top = `${obj.y + obj.h / 2}px`;
      gameArea.appendChild(trail);
      setTimeout(() => trail.remove(), 400);
    }

    function checkCollisions() {
      const playerRect = { x: player.x, y: player.y, w: player.w, h: player.h };

      for (let i = objects.length - 1; i >= 0; i--) {
        const obj = objects[i];
        const rect = { x: obj.x, y: obj.y, w: obj.w, h: obj.h };
        if (isColliding(playerRect, rect)) {
          if (obj.type === 'obstacle') {
            triggerHit();
            return;
          } else if (obj.type.startsWith('coin')) {
            collectCoin(obj.points || 1, obj);
            obj.el.remove();
            objects.splice(i, 1);
          }
        }
      }

      for (let i = monsters.length - 1; i >= 0; i--) {
        const m = monsters[i];
        const rect = { x: m.x, y: m.y, w: m.w, h: m.h };
        if (isColliding(playerRect, rect)) {
          triggerHit();
          return;
        }
      }

      if (boss) {
        const bRect = { x: boss.x, y: boss.y, w: boss.w, h: boss.h };
        if (isColliding(playerRect, bRect) && player.vy < 0) {
          bossHealth -= 1;
          bossGauge.style.width = `${(bossHealth / bossMaxHealth) * 100}%`;
          createParticles(boss.x + boss.w / 2, boss.y + 40, true);
          player.vy = difficulty.jump * 0.6;
          if (bossHealth <= 0) defeatBoss();
        } else if (isColliding(playerRect, bRect)) {
          triggerHit();
        }
      }
    }

    function triggerHit() {
      statusText.textContent = 'Ïïó! Î∂ÄÎî™ÌòîÏñ¥Ïöî';
      gameWrapper.classList.add('shake');
      setTimeout(() => gameWrapper.classList.remove('shake'), 400);
      endGame('üí• ÎØ∏ÏïºÏò¨Ïù¥ Î∂ÄÎî™ÌòîÏñ¥Ïöî! Îã§Ïãú ÎèÑÏ†Ñ?');
    }

    function collectCoin(points, obj) {
      score += points;
      coinScore += points;
      statusText.textContent = `ÏΩîÏù∏ +${points}!`;
      const popup = document.createElement('div');
      popup.className = 'popup';
      popup.textContent = `+${points}`;
      popup.style.left = `${obj.x}px`;
      popup.style.top = `${obj.y}px`;
      gameArea.appendChild(popup);
      setTimeout(() => popup.remove(), 900);
      createParticles(obj.x, obj.y);
      if (coinScore >= 5) levelUp();
    }

    function levelUp() {
      level += 1;
      coinScore = 0;
      speedMultiplier += 0.12;
      statusText.textContent = `Î†àÎ≤® ${level}! Îçî Îπ®ÎùºÏ°åÏñ¥Ïöî`;
      gameWrapper.classList.add('celebrate');
      setTimeout(() => gameWrapper.classList.remove('celebrate'), 1000);
      costumeModal.style.display = 'block';
      if (level % 5 === 0 && !boss) spawnBoss();
    }

    function applyCostume(costume) {
      playerEl.classList.remove('outfit-star', 'outfit-heart', 'outfit-sky', 'outfit-rainbow');
      if (costume === 'outfit-rainbow' && level < 4) {
        statusText.textContent = 'Î†àÎ≤® 4 Ïù¥ÌõÑ Ï∞©Ïö© Í∞ÄÎä•!';
      } else {
        playerEl.classList.add(costume);
        player.costume = costume;
      }
      costumeModal.style.display = 'none';
    }

    function defeatBoss() {
      boss.el.remove();
      boss = null;
      bossBar.style.display = 'none';
      statusText.textContent = 'Î≥¥Ïä§ Í≤©Ìåå! Î¨¥ÏßÄÍ∞ú Ìè≠Ï£Ω!';
      showBossFireworks();
      score += 5;
      document.getElementById('bossDefeat').style.display = 'block';
      setTimeout(() => document.getElementById('bossDefeat').style.display = 'none', 1400);
    }

    function showBossFireworks() {
      for (let i = 0; i < 18; i++) {
        createParticles(Math.random() * gameArea.clientWidth, 180, true);
      }
    }

    function createParticles(x, y, rainbow = false) {
      for (let i = 0; i < 6; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = `${x + Math.random() * 20 - 10}px`;
        p.style.top = `${y + Math.random() * 12 - 6}px`;
        p.style.background = rainbow ? `linear-gradient(120deg, ${randomColor()}, ${randomColor()})` : 'linear-gradient(120deg, #ff9de6, #9bf6ff)';
        gameArea.appendChild(p);
        setTimeout(() => p.remove(), 800);
      }
    }

    function getSpeed() {
      return difficulty.baseSpeed + level * 0.3;
    }

    function isColliding(a, b) {
      return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
    }

    function updateHUD() {
      levelText.textContent = level;
      scoreText.textContent = score;
      speedText.textContent = `${(speedMultiplier).toFixed(1)}x`;
      coinText.textContent = `${coinScore}/5`;
      progressBar.style.width = `${(coinScore / 5) * 100}%`;
    }

    function endGame(message) {
      gameOver = true;
      resultMessage.textContent = message;
      resultScreen.style.display = 'block';
    }

    function restartGame() {
      resetGame();
      resultScreen.style.display = 'none';
      requestAnimationFrame(loop);
    }

    function randomColor() {
      const colors = ['#ff9de6', '#ffd166', '#9bf6ff', '#b5f7c0', '#a29bfe', '#ffadad'];
      return colors[Math.floor(Math.random() * colors.length)];
    }
  </script>
</body>
</html>
